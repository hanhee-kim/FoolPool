<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="mapper.drfoolpool">
 
 
 
 	<!-- DB컬럼명과 DTO필드명 매핑 -->
 	<resultMap type="DrFoolPool" id="DrFoolPoolResultMap">
		<result property="no" column="NO"/>
		<result property="title" column="TITLE"/>
		<result property="date" column="DATE"/>
		<result property="view" column="VIEW"/>
		<result property="content" column="CONTENT"/>
		<result property="fileName" column="FILE_NAME"/>
		<result property="isSolved" column="IS_SOLVED"/>
		<result property="writerId" column="WRITER_ID"/>
		<result property="writerNickname" column="WRITER_NICKNAME"/>
	</resultMap>
 
 	<!-- 쿼리문 작성하기 -->
 
 	<!-- 1-1. 게시글목록 조회 -->
 	<select id="selectDrFoolPoolList" parameterType="map" resultType="DrFoolPool" resultMap="DrFoolPoolResultMap">
	    SELECT * FROM drfoolpool
	    <where>
	        <choose>
	            <when test="filter.equals('all')">(is_solved = 0 OR is_solved = 1)</when>
	            <when test="filter.equals('unsolved')">is_solved = 0</when>
	            <when test="filter.equals('solved')">is_solved = 1</when>
	        </choose>
	    </where>
	    ORDER BY date DESC
	    LIMIT #{row}, 6
	</select>
 	
 	<!-- 1-2. 전체 페이지수 계산을 위한 전체 행 수 조회 -->
 	<select id="selectDrFoolPoolCount" parameterType="Integer" resultType="Integer">
	    SELECT COUNT(no) FROM drfoolpool where 1=1
	    <if test="value == 2">and (is_solved = 0 OR is_solved = 1)</if>
        <if test="value == 0">and is_solved = 0</if>
        <if test="value == 1">and is_solved = 1</if>
	</select>
 	
 	
 	<!-- 2. 게시글 작성 -->
 	<!-- # 로그인 처리 이후 수정할것 -->
	<insert id="insertDrFoolPool" parameterType="DrFoolPool" useGeneratedKeys="true" keyProperty="no">
		<![CDATA[
 			INSERT INTO DRFOOLPOOL 
 			(title, DATE, content, file_name, writer_id, writer_nickname)
			VALUES
			(#{title}, now(), #{content}, #{fileName}, #{writerId}, #{writerNickname});
 		]]>
	</insert>
	
 	<!-- 3. 게시글 상세 -->
	<select id="selectDrFoolPool" parameterType="Integer" resultType="DrFoolPool" resultMap="DrFoolPoolResultMap">
 		<![CDATA[
 			select * from drfoolpool where no=#{no}
 		]]>
 	</select>
	<update id="updateDrFoolPoolViewCnt" parameterType="Integer">
 		<![CDATA[
 			update drfoolpool set view=view+1 where no=#{no}
 		]]>
 	</update>
	<!-- 충돌수정 -->



 
 	
 </mapper>